<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basketball Stat Tracker 5.1</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #0f172a;
      color: #f8fafc;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .app {
      background: #020617;
      padding: 20px;
      border-radius: 16px;
      width: 100%;
      max-width: 950px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    h1,h2,h3{text-align:center;margin:10px 0;}
    input{padding:6px;border-radius:6px;border:none;margin-right:6px;width:110px;}
    button{background:#2563eb;border:none;color:white;padding:6px 12px;margin:4px;border-radius:6px;cursor:pointer;}
    button.secondary{background:#475569;}
    .teams{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
    .team{border:1px solid #1e293b;border-radius:12px;padding:12px;}
    .player{display:grid;grid-template-columns:auto 1fr auto auto;gap:10px;align-items:center;margin:6px 0;}
    .active{color:#38bdf8;}
    .scoreboard{display:flex;justify-content:space-around;margin-bottom:12px;font-size:1.4rem;}
    .keymap{font-size:0.85rem;border:1px solid #1e293b;border-radius:12px;padding:10px;margin-top:16px;}
    .game-buttons { display:flex; justify-content:center; margin-bottom:12px; gap:8px; }
  </style>
</head>
<body>
  <div class="app">
    <h1>üèÄ Player Stat Tracker 5.1</h1>

    <div class="setup">
      <h2>Pre-Game Roster</h2>
      <div class="teams">
        <div class="team">
          <h3><input id="teamANameInput" placeholder="Team A Name" value="Team A" /></h3>
          <input id="aNum" placeholder="#" />
          <input id="aName" placeholder="Name" />
          <button onclick="addPlayer('A')">Add</button>
          <ul id="aRoster"></ul>
        </div>
        <div class="team">
          <h3><input id="teamBNameInput" placeholder="Team B Name" value="Team B" /></h3>
          <input id="bNum" placeholder="#" />
          <input id="bName" placeholder="Name" />
          <button onclick="addPlayer('B')">Add</button>
          <ul id="bRoster"></ul>
        </div>
      </div>
      <button class="secondary" onclick="startGame()">Start Game</button>
    </div>

    <div id="game" style="display:none;">
      <div class="scoreboard">
        <div><span id="teamALabel">Team A</span>: <strong id="teamAPoints">0</strong> (Fouls: <span id="teamAFouls">0</span>)</div>
        <div><span id="teamBLabel">Team B</span>: <strong id="teamBPoints">0</strong> (Fouls: <span id="teamBFouls">0</span>)</div>
      </div>

      <div class="teams">
        <div class="team"><h3 id="teamAHeader">Team A</h3><div id="aPlayers"></div></div>
        <div class="team"><h3 id="teamBHeader">Team B</h3><div id="bPlayers"></div></div>
      </div>

      <div class="game-buttons">
        <button class="secondary" onclick="resetGame()">Reset Game</button>
        <button class="secondary" onclick="undoLastAction()">Undo Last Action</button>
      </div>

      <div class="keymap">
        <strong>Keyboard Workflow</strong><br />
        Type player number ‚Üí Enter (select player)<br />
        1 / 2 / 3 ‚Üí points for selected player<br />
        F ‚Üí foul (shows notification)<br />
        T ‚Üí switch team
      </div>
    </div>
  </div>

  <script>
    const state = { A:[], B:[], activeTeam:'A', activePlayer:null, numberBuffer:'' };
    const history = [];

    // --- Player Management ---
    function addPlayer(team) {
      const numInput=document.getElementById(team==='A'?'aNum':'bNum');
      const nameInput=document.getElementById(team==='A'?'aName':'bName');
      const number=numInput.value.trim();
      const name=nameInput.value.trim();
      if(!number||!name) return;
      if(state[team].some(p=>p.number===number)){ alert('Duplicate number'); return; }
      state[team].push({number,name,points:0,fouls:0});
      numInput.value=''; nameInput.value='';
      renderRoster();
      saveState();
    }

    function renderRoster(){
      ['A','B'].forEach(team=>{
        const ul=document.getElementById(team==='A'?'aRoster':'bRoster');
        ul.innerHTML='';
        state[team].forEach(p=>{const li=document.createElement('li'); li.textContent=`#${p.number} ${p.name}`; ul.appendChild(li);});
      });
    }

    function startGame(){
      // Save team names
      const aName = document.getElementById('teamANameInput').value.trim() || 'Team A';
      const bName = document.getElementById('teamBNameInput').value.trim() || 'Team B';
      document.getElementById('teamALabel').textContent = aName;
      document.getElementById('teamBLabel').textContent = bName;
      document.getElementById('teamAHeader').textContent = aName;
      document.getElementById('teamBHeader').textContent = bName;

      document.querySelector('.setup').style.display='none';
      document.getElementById('game').style.display='block';
      if(Notification.permission!=='granted') Notification.requestPermission();
      renderPlayers();
    }

    function renderPlayers(){
      ['A','B'].forEach(team=>{
        const div=document.getElementById(team==='A'?'aPlayers':'bPlayers');
        div.innerHTML='';
        state[team].forEach(p=>{
          const row=document.createElement('div');
          row.className='player '+(state.activePlayer===p?'active':'');
          row.innerHTML=`<span>#${p.number}</span><span>${p.name}</span><span>P:${p.points}</span><span>F:${p.fouls}</span>`;
          div.appendChild(row);
        });
      });
      updateTotals();
    }

    function updateTotals(){
      const sum=t=>state[t].reduce((a,p)=>({points:a.points+p.points,fouls:a.fouls+p.fouls}),{points:0,fouls:0});
      const A=sum('A'), B=sum('B');
      teamAPoints.textContent=A.points; teamAFouls.textContent=A.fouls;
      teamBPoints.textContent=B.points; teamBFouls.textContent=B.fouls;
    }

    function selectByNumber(num){
      const p=state[state.activeTeam].find(x=>x.number===num);
      if(p){ state.activePlayer=p; renderPlayers(); }
    }

    function notifyFoul(player){
      const teamFouls=state[state.activeTeam].reduce((s,p)=>s+p.fouls,0);
      if(Notification.permission==='granted'){
        new Notification('Foul Recorded',{body:`${player.name} (#${player.number})\nPersonal Fouls: ${player.fouls}\nTeam Fouls: ${teamFouls}`});
      } else {
        alert(`${player.name} foul\nPersonal: ${player.fouls}\nTeam: ${teamFouls}`);
      }
    }

    // --- Reset / Undo ---
    function resetGame(){
      if(!confirm('Are you sure you want to reset the game?')) return;

      // Clear all player stats
      state.A.forEach(p => { p.points = 0; p.fouls = 0; });
      state.B.forEach(p => { p.points = 0; p.fouls = 0; });

      // Reset active state
      state.activeTeam = 'A';
      state.activePlayer = null;
      state.numberBuffer = '';
      history.length = 0;

      // Return to setup screen
      document.querySelector('.setup').style.display = 'block';
      document.getElementById('game').style.display = 'none';

      // Re-render roster in setup
      renderRoster();
      renderPlayers();
      saveState();
    }

    function undoLastAction(){
      if(history.length===0){ alert('No actions to undo'); return; }
      const last=history.pop();
      switch(last.type){
        case 'point':
          state[last.team][last.playerIndex].points-=last.value;
          break;
        case 'foul':
          state[last.team][last.playerIndex].fouls-=last.value;
          break;
        case 'team':
          state.activeTeam=last.prevTeam;
          break;
      }
      state.activePlayer=null;
      state.numberBuffer='';
      renderPlayers();
      saveState();
    }

    // --- Save / Load ---
    function saveState(){ localStorage.setItem('basketballState',JSON.stringify(state)); }

    function loadState(){
      const saved=localStorage.getItem('basketballState');
      if(saved){
        const parsed=JSON.parse(saved);
        state.A=parsed.A||[];
        state.B=parsed.B||[];
        state.activeTeam=parsed.activeTeam||'A';
        state.activePlayer=null;
        state.numberBuffer='';
        renderRoster();
        renderPlayers();
        document.querySelector('.setup').style.display='none';
        document.getElementById('game').style.display='block';
      }
    }

    // --- Keyboard handler ---
    document.addEventListener('keydown', e=>{
      // Jersey entry mode
      if(!state.activePlayer){
        if(/\d/.test(e.key)){ state.numberBuffer+=e.key; return; }
        if(e.key==='Enter' && state.numberBuffer){ selectByNumber(state.numberBuffer); state.numberBuffer=''; return; }
        if(e.key.toLowerCase()==='t'){ history.push({type:'team', prevTeam: state.activeTeam}); state.activeTeam=state.activeTeam==='A'?'B':'A'; state.numberBuffer=''; renderPlayers(); saveState(); }
        return;
      }

      // Action mode
      if(['1','2','3'].includes(e.key)){
        const value=Number(e.key);
        const team=state.activeTeam;
        const playerIndex=state[team].indexOf(state.activePlayer);
        state.activePlayer.points+=value;
        history.push({type:'point', team, playerIndex, value});
        state.activePlayer=null;
        state.numberBuffer='';
        renderPlayers();
        saveState();
        return;
      }
      if(e.key.toLowerCase()==='f'){
        const team=state.activeTeam;
        const playerIndex=state[team].indexOf(state.activePlayer);
        state.activePlayer.fouls++;
        history.push({type:'foul', team, playerIndex, value:1});
        const p=state.activePlayer;
        state.activePlayer=null;
        state.numberBuffer='';
        renderPlayers();
        notifyFoul(p);
        saveState();
        return;
      }
      if(e.key.toLowerCase()==='t'){
        history.push({type:'team', prevTeam: state.activeTeam});
        state.activeTeam=state.activeTeam==='A'?'B':'A';
        state.activePlayer=null;
        state.numberBuffer='';
        renderPlayers();
        saveState();
      }
    });

    // Load saved state on page load
    loadState();
  </script>
</body>
</html>
